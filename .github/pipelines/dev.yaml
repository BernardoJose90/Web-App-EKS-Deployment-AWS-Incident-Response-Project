on:
  push:
    branches:
      - dev

jobs:
  lint:
    uses: ../templates/lint.yml

  plan_apply:
    needs: lint
    uses: ../templates/init_plan.yml
    with:
      backend_file: terraform/environments/dev/backend.tfvars
      tfvars_file: terraform/environments/dev/dev.tfvars

  apply:
    needs: plan_apply
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
      - name: Apply Terraform Plan
        run: terraform apply -auto-approve tfplan
      - name: Notify Slack
        uses: ../templates/notify.yml    
