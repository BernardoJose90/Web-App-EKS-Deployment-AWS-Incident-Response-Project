name: "Prod Terraform + EKS CI"

on:
  workflow_dispatch:
    inputs:
      region:
        description: "AWS Region (eu-west-2 for London / eu-west-1 for Ireland)"
        required: true
        default: "eu-west-2"
      environment_name:
        description: "Environment name"
        required: true
        default: "prod"
      cluster_name:
        description: "EKS Cluster Name"
        required: true
        default: "prod-eks-cluster"

permissions:
  id-token: write
  contents: read

jobs:
  terraform_apply:
    uses: ./.github/workflows/apply.yaml
    with:
      region: ${{ github.event.inputs.region }}
      environment_name: ${{ github.event.inputs.environment_name }}
      cluster_name: ${{ github.event.inputs.cluster_name }}
      tfvars_file: "prod.tfvars"
      s3_bucket: "cloudsec-project-tfstate"
      kms_secret_name: "prod/kms-key"
